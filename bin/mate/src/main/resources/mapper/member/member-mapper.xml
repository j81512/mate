<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">

	<insert id="insertMember">
		insert into
			member
		values (
			#{ memberId },
			#{ memberPWD },
			#{ memberName },
			#{ gender },
			#{ phone },
			default
		)
		
	</insert>

	<select id="selectOneMember" resultMap="memberMap">
		select 
			*
		from
			member
		where
			member_id = #{ memberId }
	</select>
	
	<resultMap type="member" id="memberMap">
	
	</resultMap>
	
	<update id="updateMember">
 		update
 			member
 		<set>
 			<if test="memberId != null">
 				member_id = #{ memberId },
 			</if>
 			<if test="memberPWD != null">
 				member_pwd = #{ memberPWD },
 			</if>
 			<if test="memberName != null">
 				member_name = #{ memberName },
 			</if>
 			<if test="gender != null">
 				gender = #{ gender },
 			</if>
 			<if test="phone != null">
 				phone = #{ phone }
 			</if>
 		</set>
 		where member_id = #{ memberId }
 	</update>
	
	<delete id="deleteMember">
		delete from member where member_id = #{ memberId }
	</delete>
	
	<select id="selectAllPurchase" resultMap="purchaseMap">
		select
		    PL.purchase_no purchase_no,
		    p.purchase_date purchase_date,
		    p.member_id member_id,
		    pl.purchase_log_no purchase_log_no,
		    pl.product_no product_no,
		    (select product_name from product where product_no = pl.product_no) product_name,
		    pl.amount amount,
		    pl.status status
		from
			purchase_log PL
				join
			purchase P
				on P.purchase_no = PL.purchase_no
        where
            member_id = #{ memberId }
        order by
        	purchase_date desc
	</select>
	<resultMap id="purchaseMap" type="map">
		<result column="purchase_no" property="purchaseNo"/>
		<result column="purchase_date" property="purchaseDate"/>
		<result column="member_id" property="memberId"/>
		<result column="purchase_log_no" property="purchaseLogNo"/>
		<result column="product_no" property="productNo"/>
		<result column="product_name" property="productName"/>
		<result column="amount" property="amount"/>
		<result column="status" property="status"/>
	</resultMap>
</mapper>